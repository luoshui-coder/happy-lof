# é…ç½®åº”ç”¨åœ¨å­è·¯å¾„ /happy-lof ä¸‹è¿è¡Œ

## ğŸ“‹ éœ€æ±‚è¯´æ˜

å°†åº”ç”¨ä»æ ¹è·¯å¾„ `/` è¿ç§»åˆ°å­è·¯å¾„ `/happy-lof`ï¼Œä½¿è®¿é—®åœ°å€å˜ä¸ºï¼š
- åŸåœ°å€ï¼š`https://luoshui.top/`
- æ–°åœ°å€ï¼š`https://luoshui.top/happy-lof`

---

## ğŸ”§ æ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆ 1ï¼šNginx è·¯å¾„é‡å†™ï¼ˆæ¨èï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… æ— éœ€ä¿®æ”¹ Flask ä»£ç 
- âœ… é…ç½®ç®€å•
- âœ… å¯¹åº”ç”¨é€æ˜

**Nginx é…ç½®**ï¼š
```nginx
location /happy-lof {
    # å»æ‰è·¯å¾„å‰ç¼€ï¼Œä¼ é€’ç»™ Flask
    rewrite ^/happy-lof(.*)$ $1 break;
    proxy_pass http://127.0.0.1:5000;
    
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_connect_timeout 30s;
    proxy_read_timeout 86400s;
    proxy_send_timeout 30s;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}
```

**å·¥ä½œåŸç†**ï¼š
- ç”¨æˆ·è®¿é—®ï¼š`https://luoshui.top/happy-lof/api/lof`
- Nginx é‡å†™ä¸ºï¼š`/api/lof`
- ä¼ é€’ç»™ Flaskï¼š`http://127.0.0.1:5000/api/lof`

---

### æ–¹æ¡ˆ 2ï¼šFlask åº”ç”¨é…ç½®å­è·¯å¾„ï¼ˆéœ€è¦ä¿®æ”¹ä»£ç ï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… åº”ç”¨æ„ŸçŸ¥å®Œæ•´è·¯å¾„
- âœ… æ›´çµæ´»çš„è·¯ç”±æ§åˆ¶

**ç¼ºç‚¹**ï¼š
- âŒ éœ€è¦ä¿®æ”¹ä»£ç 
- âŒ é™æ€èµ„æºè·¯å¾„éœ€è¦è°ƒæ•´

**ä¿®æ”¹æ­¥éª¤**ï¼š

#### 1. ä¿®æ”¹ `app.py`

```python
from flask import Flask
from werkzeug.middleware.proxy_fix import ProxyFix

app = Flask(__name__, static_folder='static')

# é…ç½®åº”ç”¨åœ¨å­è·¯å¾„ä¸‹è¿è¡Œ
app.config['APPLICATION_ROOT'] = '/happy-lof'

# å¤„ç†åå‘ä»£ç†çš„å¤´ä¿¡æ¯
app.wsgi_app = ProxyFix(app.wsgi_app, x_for=1, x_proto=1, x_host=1, x_prefix=1)
```

#### 2. ä¿®æ”¹ `static/index.html` ä¸­çš„ API è·¯å¾„

```javascript
// åŸä»£ç 
fetch('/api/lof')

// ä¿®æ”¹ä¸º
fetch('/happy-lof/api/lof')
```

#### 3. Nginx é…ç½®ï¼ˆä¸éœ€è¦ rewriteï¼‰

```nginx
location /happy-lof {
    proxy_pass http://127.0.0.1:5000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Script-Name /happy-lof;
}
```

---

## âœ… æ¨èé…ç½®ï¼ˆæ–¹æ¡ˆ 1 - æœ€ç®€å•ï¼‰

### æ­¥éª¤ 1ï¼šä¿®æ”¹ Nginx é…ç½®

åœ¨å®å¡”é¢æ¿ä¸­ï¼Œå°†é…ç½®æ–‡ä»¶ä¿®æ”¹ä¸ºï¼š

```nginx
server {
    listen 80;
    listen 443 ssl;
    listen 443 quic;
    http2 on;
    server_name luoshui.top;
    
    # ... SSL é…ç½®ä¿æŒä¸å˜ ...
    
    # æ ¹è·¯å¾„é‡å®šå‘åˆ° /happy-lof
    location = / {
        return 301 https://$host/happy-lof;
    }
    
    # happy-lof åº”ç”¨ï¼ˆå…³é”®é…ç½®ï¼‰
    location /happy-lof {
        # å»æ‰ /happy-lof å‰ç¼€ï¼Œä¼ é€’ç»™ Flask
        rewrite ^/happy-lof(.*)$ $1 break;
        
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 30s;
        proxy_read_timeout 86400s;
        proxy_send_timeout 30s;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
    
    # å…¶ä»–è·¯å¾„è¿”å› 404
    location / {
        return 404;
    }
}
```

### æ­¥éª¤ 2ï¼šä¿å­˜å¹¶é‡å¯ Nginx

åœ¨å®å¡”é¢æ¿ä¸­ï¼š
1. ä¿å­˜é…ç½®
2. é‡å¯ Nginx

### æ­¥éª¤ 3ï¼šæµ‹è¯•è®¿é—®

```bash
# 1. è®¿é—®æ ¹è·¯å¾„ï¼ˆä¼šè‡ªåŠ¨è·³è½¬ï¼‰
https://luoshui.top/

# 2. ç›´æ¥è®¿é—®åº”ç”¨
https://luoshui.top/happy-lof

# 3. æµ‹è¯• API
https://luoshui.top/happy-lof/api/lof
```

---

## ğŸ” éªŒè¯æ¸…å•

- [ ] `https://luoshui.top/` è‡ªåŠ¨è·³è½¬åˆ° `https://luoshui.top/happy-lof`
- [ ] `https://luoshui.top/happy-lof` æ˜¾ç¤ºé¦–é¡µ
- [ ] `https://luoshui.top/happy-lof/api/lof` è¿”å› JSON æ•°æ®
- [ ] é¡µé¢ä¸­çš„ API è¯·æ±‚æ­£å¸¸å·¥ä½œ
- [ ] é™æ€èµ„æºï¼ˆCSS/JSï¼‰æ­£å¸¸åŠ è½½

---

## ğŸš¨ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šé¡µé¢æ˜¾ç¤ºæ­£å¸¸ï¼Œä½† API è¯·æ±‚å¤±è´¥

**åŸå› **ï¼šå‰ç«¯ä»£ç ä¸­çš„ API è·¯å¾„æ²¡æœ‰åŒ…å« `/happy-lof` å‰ç¼€

**è§£å†³**ï¼šæ£€æŸ¥ `static/index.html` ä¸­çš„ fetch è¯·æ±‚è·¯å¾„

```javascript
// é”™è¯¯
fetch('/api/lof')

// æ­£ç¡®ï¼ˆæ–¹æ¡ˆ 1 ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼‰
fetch('api/lof')  // ç›¸å¯¹äºå½“å‰è·¯å¾„ /happy-lof

// æˆ–ä½¿ç”¨ç»å¯¹è·¯å¾„
fetch('/happy-lof/api/lof')
```

### é—®é¢˜ 2ï¼šé™æ€èµ„æº 404

**åŸå› **ï¼šé™æ€èµ„æºè·¯å¾„ä¸æ­£ç¡®

**è§£å†³**ï¼šåœ¨ HTML ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„

```html
<!-- ç›¸å¯¹è·¯å¾„ï¼ˆæ¨èï¼‰ -->
<link rel="stylesheet" href="style.css">

<!-- ç»å¯¹è·¯å¾„ -->
<link rel="stylesheet" href="/happy-lof/style.css">
```

### é—®é¢˜ 3ï¼šè®¿é—® `/happy-lof` è¿”å› 404

**åŸå› **ï¼šNginx é…ç½®æœªç”Ÿæ•ˆ

**è§£å†³**ï¼š
```bash
# SSH è¿æ¥æœåŠ¡å™¨
sudo nginx -t  # æ£€æŸ¥é…ç½®
sudo systemctl restart nginx  # é‡å¯ Nginx
```

---

## ğŸ“ å®Œæ•´é…ç½®æ–‡ä»¶

æˆ‘å·²ç»ä¸ºä½ ç”Ÿæˆäº†å®Œæ•´çš„é…ç½®æ–‡ä»¶ï¼š`nginx-config-with-path.conf`

**ä½¿ç”¨æ–¹æ³•**ï¼š
1. å¤åˆ¶æ–‡ä»¶å†…å®¹
2. åœ¨å®å¡”é¢æ¿ä¸­ç²˜è´´åˆ°ç½‘ç«™é…ç½®
3. ä¿å­˜å¹¶é‡å¯ Nginx
4. æµ‹è¯•è®¿é—®

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **ç«‹å³æ‰§è¡Œ**ï¼šä½¿ç”¨æ–¹æ¡ˆ 1 ä¿®æ”¹ Nginx é…ç½®ï¼ˆæœ€ç®€å•ï¼‰
2. **æµ‹è¯•éªŒè¯**ï¼šç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
3. **å¦‚æœéœ€è¦**ï¼šå†è€ƒè™‘æ–¹æ¡ˆ 2ï¼ˆä¿®æ”¹ Flask ä»£ç ï¼‰

**é¢„è®¡å®Œæˆæ—¶é—´ï¼š10 åˆ†é’Ÿ**
