# 宝塔面板部署指南 - LOF基金套利监控系统

## 🚀 最简单的部署方式（推荐）

### 方式一：使用宝塔 Python 项目管理器（最方便）

#### 1. 安装 Python 项目管理器
- 登录宝塔面板
- 进入 **软件商店** → 搜索 **"Python项目管理器"**
- 点击安装（免费）

#### 2. 上传项目代码
```bash
# 在服务器上执行
cd /www/wwwroot
git clone https://github.com/luoshui-coder/happy-lof.git
cd happy-lof
```

#### 3. 配置 Python 项目
1. 打开宝塔面板 → **Python项目管理器**
2. 点击 **添加项目**
3. 填写配置：
   - **项目名称**：`LOF基金套利`
   - **项目路径**：`/www/wwwroot/happy-lof`
   - **Python版本**：选择 `Python 3.9+`
   - **启动方式**：`python`
   - **启动文件**：`app.py`
   - **端口**：`5000`（或其他未占用端口）
   - **是否开机启动**：勾选 ✅

4. 点击 **提交**

#### 4. 安装依赖
在 Python 项目管理器中，点击项目的 **终端** 按钮，执行：
```bash
pip install -r requirements.txt
```

#### 5. 启动项目
点击项目的 **启动** 按钮即可！

---

### 方式二：使用 Supervisor + Nginx（更专业）

#### 1. 上传代码
```bash
cd /www/wwwroot
git clone https://github.com/luoshui-coder/happy-lof.git
cd happy-lof
```

#### 2. 创建虚拟环境并安装依赖
```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

#### 3. 配置 Supervisor（进程守护）
在宝塔面板：
1. **软件商店** → 安装 **Supervisor管理器**
2. 打开 **Supervisor管理器** → 点击 **添加守护进程**
3. 填写配置：

```ini
[program:lof-arbitrage]
directory=/www/wwwroot/happy-lof
command=/www/wwwroot/happy-lof/venv/bin/python app.py
autostart=true
autorestart=true
startsecs=3
startretries=3
stdout_logfile=/www/wwwroot/happy-lof/logs/supervisor.log
stderr_logfile=/www/wwwroot/happy-lof/logs/supervisor_error.log
user=www
```

4. 点击 **确定** 并 **启动**

#### 4. 配置 Nginx 反向代理
1. 宝塔面板 → **网站** → **添加站点**
   - **域名**：填写你的域名（如 `lof.yourdomain.com`）
   - **根目录**：随便选一个（不重要）
   - **PHP版本**：纯静态

2. 点击站点设置 → **反向代理** → **添加反向代理**
   - **代理名称**：`LOF套利`
   - **目标URL**：`http://127.0.0.1:5000`
   - **发送域名**：`$host`

3. 保存即可！

---

### 方式三：使用 Docker（最现代化）

#### 1. 创建 Dockerfile
在项目根目录创建 `Dockerfile`：

```dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 5000

CMD ["python", "app.py"]
```

#### 2. 创建 docker-compose.yml
```yaml
version: '3.8'

services:
  lof-app:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - ./lof_history.db:/app/lof_history.db
      - ./app.log:/app/app.log
    restart: always
    environment:
      - TZ=Asia/Shanghai
```

#### 3. 部署
```bash
# 安装 Docker（宝塔面板 → 软件商店 → Docker管理器）
cd /www/wwwroot/happy-lof
docker-compose up -d
```

---

## 🔧 重要配置项

### 1. 修改监听地址（重要！）
编辑 `app.py`，将最后一行改为：
```python
app.run(host='0.0.0.0', port=5000, debug=False)
```

### 2. 配置定时任务
在宝塔面板 → **计划任务** → **Shell脚本**

**任务名称**：LOF数据定时采集  
**执行周期**：每天 14:55  
**脚本内容**：
```bash
#!/bin/bash
cd /www/wwwroot/happy-lof
source venv/bin/activate  # 如果使用虚拟环境
python database.py
```

### 3. 开放端口
- 宝塔面板 → **安全** → 放行端口 `5000`
- 如果使用阿里云/腾讯云，还需在安全组放行

### 4. 配置 SSL（可选）
如果使用域名访问：
1. 宝塔面板 → 网站 → 你的站点 → **SSL**
2. 选择 **Let's Encrypt** 免费证书
3. 点击申请即可

---

## 📊 访问方式

部署完成后，可以通过以下方式访问：

1. **IP访问**：`http://你的服务器IP:5000`
2. **域名访问**（配置Nginx后）：`http://lof.yourdomain.com`
3. **HTTPS访问**（配置SSL后）：`https://lof.yourdomain.com`

---

## 🔍 常见问题

### 1. 端口被占用
```bash
# 查看端口占用
netstat -tunlp | grep 5000

# 修改 app.py 中的端口号
```

### 2. 权限问题
```bash
# 给予执行权限
chmod +x start.sh
chown -R www:www /www/wwwroot/happy-lof
```

### 3. 数据库文件权限
```bash
chmod 666 lof_history.db
```

### 4. 查看日志
```bash
# 应用日志
tail -f /www/wwwroot/happy-lof/app.log

# Supervisor 日志
tail -f /www/wwwroot/happy-lof/logs/supervisor.log
```

---

## 🎯 推荐方案

**对于你的情况，我最推荐 方式一（Python项目管理器）**，因为：
- ✅ 最简单，全程可视化操作
- ✅ 自动管理进程，自动重启
- ✅ 支持开机自启
- ✅ 日志查看方便
- ✅ 一键启停

**如果追求稳定性和专业性，推荐 方式二（Supervisor + Nginx）**

祝部署顺利！🎉
