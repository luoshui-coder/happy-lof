# å­è·¯å¾„é…ç½®æ€»ç»“

## ğŸ“‹ éœ€æ±‚å›é¡¾

**åŸéœ€æ±‚**ï¼š
- åŸåœ°å€ï¼š`https://luoshui.top/` ç›´æ¥è®¿é—®åº”ç”¨
- æ–°éœ€æ±‚ï¼š`https://luoshui.top/happy-lof` æ‰èƒ½è®¿é—®åº”ç”¨

---

## âœ… è§£å†³æ–¹æ¡ˆæ€»ç»“

### æ–¹æ¡ˆé€‰æ‹©ï¼šNginx è·¯å¾„é‡å†™ + å‰ç«¯ç›¸å¯¹è·¯å¾„

**ä¼˜ç‚¹**ï¼š
- âœ… é…ç½®ç®€å•
- âœ… Flask åº”ç”¨æ— éœ€ä¿®æ”¹
- âœ… å‰ç«¯åªéœ€å°æ”¹åŠ¨
- âœ… æ˜“äºç»´æŠ¤

---

## ğŸ”§ å·²å®Œæˆçš„ä¿®æ”¹

### 1. å‰ç«¯ä»£ç ä¿®æ”¹ï¼ˆ3å¤„ï¼‰

**æ–‡ä»¶**ï¼š`static/index.html`

| ä¿®æ”¹é¡¹ | åŸä»£ç  | æ–°ä»£ç  |
|--------|--------|--------|
| API è¯·æ±‚ 1 | `fetch('/api/lof')` | `fetch('api/lof')` |
| API è¯·æ±‚ 2 | `fetch('/api/lof/history/...')` | `fetch('api/lof/history/...')` |
| å›¾æ ‡è·¯å¾„ | `href="/static/chicken.png"` | `href="chicken.png"` |

**åŸç†**ï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åŸºäºå½“å‰é¡µé¢è·¯å¾„è§£æ

### 2. Nginx é…ç½®ä¿®æ”¹

**æ–‡ä»¶**ï¼š`nginx-final-config.conf`

**å…³é”®é…ç½®**ï¼š
```nginx
# 1. æ ¹è·¯å¾„è‡ªåŠ¨è·³è½¬
location = / {
    return 301 https://$host/happy-lof;
}

# 2. happy-lof åº”ç”¨ä»£ç†
location /happy-lof {
    # å»æ‰ /happy-lof å‰ç¼€
    rewrite ^/happy-lof(.*)$ $1 break;
    
    # ä»£ç†åˆ° Flask åº”ç”¨
    proxy_pass http://127.0.0.1:5000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    # ... å…¶ä»–ä»£ç†é…ç½®
}

# 3. å…¶ä»–è·¯å¾„è¿”å› 404
location / {
    return 404;
}
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤ï¼ˆå¿«é€Ÿç‰ˆï¼‰

### æ­¥éª¤ 1ï¼šä¸Šä¼ å‰ç«¯ä»£ç 
```bash
# æ–¹æ³• 1ï¼šGit
cd /www/wwwroot/happy-lof
git pull

# æ–¹æ³• 2ï¼šæ‰‹åŠ¨ä¸Šä¼ 
# å°†ä¿®æ”¹åçš„ static/index.html ä¸Šä¼ åˆ°æœåŠ¡å™¨
```

### æ­¥éª¤ 2ï¼šæ›´æ–° Nginx é…ç½®
1. å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ luoshui.top â†’ è®¾ç½® â†’ é…ç½®æ–‡ä»¶
2. å¤åˆ¶ `nginx-final-config.conf` å†…å®¹å¹¶ç²˜è´´
3. ä¿å­˜

### æ­¥éª¤ 3ï¼šé‡å¯ Nginx
```bash
sudo systemctl restart nginx
```

### æ­¥éª¤ 4ï¼šæµ‹è¯•
```bash
# 1. æ ¹è·¯å¾„ï¼ˆè‡ªåŠ¨è·³è½¬ï¼‰
https://luoshui.top/

# 2. åº”ç”¨é¦–é¡µ
https://luoshui.top/happy-lof

# 3. API æ¥å£
https://luoshui.top/happy-lof/api/lof
```

---

## ğŸ“Š å·¥ä½œåŸç†

### è¯·æ±‚æµç¨‹ç¤ºä¾‹

#### è®¿é—®é¦–é¡µ
```
ç”¨æˆ·è¾“å…¥: https://luoshui.top/happy-lof
    â†“
Nginx æ¥æ”¶: /happy-lof
    â†“
Rewrite: /happy-lof â†’ /
    â†“
ä»£ç†è½¬å‘: http://127.0.0.1:5000/
    â†“
Flask è¿”å›: static/index.html
    â†“
æµè§ˆå™¨æ˜¾ç¤ºé¡µé¢
```

#### API è¯·æ±‚
```
JavaScript: fetch('api/lof')
    â†“
æµè§ˆå™¨è§£æ: https://luoshui.top/happy-lof/api/lof
    â†“
Nginx æ¥æ”¶: /happy-lof/api/lof
    â†“
Rewrite: /happy-lof/api/lof â†’ /api/lof
    â†“
ä»£ç†è½¬å‘: http://127.0.0.1:5000/api/lof
    â†“
Flask å¤„ç†: @app.route('/api/lof')
    â†“
è¿”å› JSON æ•°æ®
```

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶å | è¯´æ˜ |
|--------|------|
| `nginx-final-config.conf` | æœ€ç»ˆçš„ Nginx é…ç½®æ–‡ä»¶ |
| `å­è·¯å¾„éƒ¨ç½²æŒ‡å—.md` | è¯¦ç»†çš„éƒ¨ç½²æ­¥éª¤å’Œé—®é¢˜æ’æŸ¥ |
| `å­è·¯å¾„é…ç½®è¯´æ˜.md` | æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”å’ŒåŸç†è¯´æ˜ |
| `static/index.html` | å·²ä¿®æ”¹çš„å‰ç«¯æ–‡ä»¶ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰ |

---

## âœ… éªŒè¯æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·ç¡®è®¤ï¼š

- [ ] `https://luoshui.top/` â†’ è‡ªåŠ¨è·³è½¬åˆ° `/happy-lof`
- [ ] `https://luoshui.top/happy-lof` â†’ æ˜¾ç¤ºé¦–é¡µ
- [ ] é¡µé¢æ•°æ®æ­£å¸¸åŠ è½½ï¼ˆæ—  API é”™è¯¯ï¼‰
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ— é”™è¯¯ï¼ˆF12 â†’ Consoleï¼‰
- [ ] å›¾æ ‡æ­£å¸¸æ˜¾ç¤º
- [ ] åˆ·æ–°æŒ‰é’®æ­£å¸¸å·¥ä½œ
- [ ] å†å²æº¢ä»·ç‡èµ°åŠ¿å›¾æ­£å¸¸æ˜¾ç¤º

---

## ğŸš¨ å¸¸è§é—®é¢˜é€ŸæŸ¥

### é—®é¢˜ï¼šé¡µé¢ç©ºç™½
**è§£å†³**ï¼šæ£€æŸ¥ Flask åº”ç”¨æ˜¯å¦è¿è¡Œ
```bash
ps aux | grep python
netstat -tlnp | grep :5000
```

### é—®é¢˜ï¼šAPI 404
**è§£å†³**ï¼šæ£€æŸ¥å‰ç«¯ä»£ç æ˜¯å¦æ›´æ–°
```bash
# æŸ¥çœ‹å®é™…è¯·æ±‚çš„ URLï¼ˆæµè§ˆå™¨ F12 â†’ Networkï¼‰
# åº”è¯¥æ˜¯ï¼šhttps://luoshui.top/happy-lof/api/lof
```

### é—®é¢˜ï¼šæ ¹è·¯å¾„ä¸è·³è½¬
**è§£å†³**ï¼šæ£€æŸ¥ Nginx é…ç½®
```bash
sudo nginx -t
sudo systemctl restart nginx
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### å¦‚æœæ˜¯å°ç¨‹åº
è®°å¾—åœ¨å¾®ä¿¡å°ç¨‹åºåå°é…ç½®ï¼š
- æœåŠ¡å™¨åŸŸåï¼š`https://luoshui.top`
- API è¯·æ±‚ä½¿ç”¨å®Œæ•´è·¯å¾„ï¼š`https://luoshui.top/happy-lof/api/lof`

### å¦‚æœéœ€è¦å¤šä¸ªåº”ç”¨
å¯ä»¥ç»§ç»­æ·»åŠ å…¶ä»–å­è·¯å¾„ï¼š
```nginx
location /app1 {
    rewrite ^/app1(.*)$ $1 break;
    proxy_pass http://127.0.0.1:5001;
}

location /app2 {
    rewrite ^/app2(.*)$ $1 break;
    proxy_pass http://127.0.0.1:5002;
}
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœéƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. **Nginx é…ç½®æ£€æŸ¥**
   ```bash
   sudo nginx -t
   ```

2. **ç«¯å£ç›‘å¬æ£€æŸ¥**
   ```bash
   sudo netstat -tlnp | grep :5000
   ```

3. **é”™è¯¯æ—¥å¿—**
   ```bash
   sudo tail -50 /www/wwwlogs/happy-lof.error.log
   ```

4. **æµè§ˆå™¨æ§åˆ¶å°æˆªå›¾**ï¼ˆF12 â†’ Console å’Œ Networkï¼‰

---

**é¢„è®¡å®Œæˆæ—¶é—´ï¼š15 åˆ†é’Ÿ**

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰
