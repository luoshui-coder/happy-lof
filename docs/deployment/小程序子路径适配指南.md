# 小程序适配子路径指南

## 📝 核心修改

由于服务端 API 路径从 `/api` 变更为了 `/happy-lof/api`，小程序端必须同步修改 API 基础路径。

### 1. 修改 `app.js`

将 `globalData.apiBase` 修改为：

```javascript
globalData: {
  // ✅ 正确配置：包含 /happy-lof 子路径
  apiBase: 'https://luoshui.top/happy-lof/api',
}
```

**原配置**（已失效）：
- ❌ `https://luoshui.life/api` (域名错误 + 路径缺少)
- ❌ `https://luoshui.top/api` (路径缺少)

---

## ⚙️ 微信后台配置

请登录 [微信公众平台](https://mp.weixin.qq.com/)，检查服务器配置：

1. **进入路径**：开发管理 → 开发设置 → 服务器域名
2. **request 合法域名**：
   - 必须包含：`https://luoshui.top`
   - **注意**：这里只需要配置域名，不需要配置子路径

---

## 🔍 发布前自查

1. **开发者工具测试**
   - 修改 `app.js` 后，重新编译
   - 观察控制台是否能正常获取数据
   - 检查 Network 面板，请求地址应为：`https://luoshui.top/happy-lof/api/lof`

2. **真机预览**
   - 手机扫码预览，确保真机也能访问 API

---

## ❓ 常见问题

**Q: 为什么网页能打开，小程序不行？**
A: 小程序对 request 域名有严格限制，必须在后台配置。且路径必须完全匹配 Nginx 的代理规则。

**Q: 需要重新提交审核吗？**
A: 如果只是修改了 API 地址（JS代码变更），需要重新上传代码并提交审核。
